-- Création
DROP TABLE IF EXISTS Participer;
DROP TABLE IF EXISTS Joueur;
DROP TABLE IF EXISTS Jouer;
DROP TABLE IF EXISTS MatchTournoi;
DROP TABLE IF EXISTS Equipe;
DROP TABLE IF EXISTS Tournoi;
DROP TABLE IF EXISTS Utilisateurs;

CREATE TABLE IF NOT EXISTS Utilisateurs (
ID_User		INT PRIMARY KEY AUTO_INCREMENT,
Identifiant VARCHAR(25) UNIQUE NOT NULL,
Mot_de_passe VARCHAR(25) NOT NULL,
Nom VARCHAR(25),
Prenom VARCHAR(25),
Email VARCHAR(50),
Type_user INT);

CREATE TABLE IF NOT EXISTS Tournoi (
ID_Tournoi INT PRIMARY KEY AUTO_INCREMENT,
Sport VARCHAR(50),
Nom VARCHAR(255),
DateDebut DATETIME,
DateFin DATETIME);

CREATE TABLE IF NOT EXISTS MatchTournoi (
ID_Match	INT PRIMARY KEY AUTO_INCREMENT,
Sport VARCHAR(50),
DateDebut DATETIME,
DateFin DATETIME,
Stade VARCHAR(256),
ScoreEquipe1 INT,
ScoreEquipe2 INT,
ID_User INT,
ID_Tournoi INT,
CONSTRAINT fk_Match_User FOREIGN KEY (ID_User) REFERENCES Utilisateurs(ID_User) ON DELETE RESTRICT ON UPDATE RESTRICT,
CONSTRAINT fk_Match_Tournoi FOREIGN KEY (ID_Tournoi) REFERENCES Tournoi(ID_Tournoi) ON DELETE RESTRICT ON UPDATE RESTRICT);

CREATE TABLE IF NOT EXISTS Equipe (
ID_Equipe INT PRIMARY KEY AUTO_INCREMENT,
Nom VARCHAR(256),
Sport VARCHAR(256));

CREATE TABLE IF NOT EXISTS Joueur (
ID_Joueur INT PRIMARY KEY AUTO_INCREMENT,
Prenom VARCHAR(25),
Nom VARCHAR(25),
ID_Equipe INT,
CONSTRAINT fk_Joueur_Equipe FOREIGN KEY (ID_Equipe) REFERENCES Equipe(ID_Equipe) ON DELETE RESTRICT ON UPDATE RESTRICT);

CREATE TABLE IF NOT EXISTS Jouer (
ID_Match INT,
ID_Equipe INT,
CONSTRAINT fk_Jouer_Match FOREIGN KEY (ID_Match) REFERENCES MatchTournoi(ID_Match) ON DELETE RESTRICT ON UPDATE RESTRICT,
CONSTRAINT fk_Jouer_Equipe FOREIGN KEY (ID_Equipe) REFERENCES Equipe(ID_Equipe) ON DELETE RESTRICT ON UPDATE RESTRICT);

CREATE TABLE IF NOT EXISTS Participer (
ID_Tournoi INT,
ID_Equipe INT,
CONSTRAINT fk_Participer_Tournoi FOREIGN KEY (ID_Tournoi) REFERENCES Tournoi(ID_Tournoi) ON DELETE RESTRICT ON UPDATE RESTRICT,
CONSTRAINT fk_Participer_Equipe FOREIGN KEY (ID_Equipe) REFERENCES Equipe(ID_Equipe) ON DELETE RESTRICT ON UPDATE RESTRICT);
 
 -- Tests
INSERT INTO Utilisateurs VALUES(0,"iden","mdp","nom","prenom","email",0);
INSERT INTO Utilisateurs VALUES(0,"iden2","mdp","nom","prenom","email",1);
INSERT INTO Utilisateurs VALUES(0,"iden3","mdp","nom","prenom","email",2);
INSERT INTO Utilisateurs VALUES(0,"iden4","mdp","nom","prenom","email",3);

INSERT INTO Tournoi VALUES(0,"volley","Championnat de volley 2022","2023-12-24 08:30:00","2023-12-31 18:30:00");

INSERT INTO Equipe VALUES(0,"Volley_bourg","volley");
INSERT INTO Equipe VALUES(0,"Volley_saint-denis","volley");

SELECT * FROM Equipe;

INSERT INTO Joueur VALUES(0,"Nathan","Ozimek",1);
INSERT INTO Joueur VALUES(0,"Jean-François","Marcourt",1);
INSERT INTO Joueur VALUES(0,"Gaël","Journet",2);

INSERT INTO MatchTournoi VALUES(0,"volley","2023-12-24 09:00:00","2023-12-24 10:00:00","stade de bourg",0,0,2,1);

INSERT INTO Jouer VALUES(1,1);
INSERT INTO Jouer VALUES(1,2);

INSERT INTO Participer VALUES(1,1);
INSERT INTO Participer VALUES(1,2);

SELECT * FROM Utilisateurs;
SELECT * FROM Tournoi;
SELECT * FROM MatchTournoi;
SELECT * FROM Equipe;
SELECT * FROM Joueur;
SELECT * FROM Jouer;
SELECT * FROM Participer;